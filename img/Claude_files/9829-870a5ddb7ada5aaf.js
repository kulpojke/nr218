try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="a4f2de94-ff89-4b90-96b4-d77dfb9c2ece",e._sentryDebugIdIdentifier="sentry-dbid-a4f2de94-ff89-4b90-96b4-d77dfb9c2ece")}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9829],{52909:(e,t,a)=>{a.d(t,{CO:()=>f,M3:()=>u,bG:()=>c,ks:()=>p,pz:()=>o,z_:()=>d});var n=a(77186),i=a(1761),r=a(71473),l=a(87606),s=a(91768);let o=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{activeOrganization:a}=(0,i.YL)(),r=null==a?void 0:a.uuid,l=g(),o=(0,s.eL)();return(0,n.L2)(()=>"/api/organizations/".concat(r,"/projects/").concat(e,"/syncs"),"POST",{enabled:!!(a&&e),...t,onSuccess:function(){for(var a,n=arguments.length,i=Array(n),r=0;r<n;r++)i[r]=arguments[r];l(e),null==(a=t.onSuccess)||a.call(t,...i)},onError:function(){for(var e,a=arguments.length,n=Array(a),i=0;i<a;i++)n[i]=arguments[i];null==(e=t.onError)||e.call(t,...n);let[r,l]=n;o(r,l)}})},u=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{activeOrganization:a}=(0,i.YL)(),r=null==a?void 0:a.uuid,l=g();return(0,n.L2)(()=>"/api/organizations/".concat(r,"/projects/").concat(e,"/syncs"),"PUT",{enabled:!!(a&&e),...t,onSuccess:function(){for(var a,n=arguments.length,i=Array(n),r=0;r<n;r++)i[r]=arguments[r];l(e),null==(a=t.onSuccess)||a.call(t,...i)}})},c=e=>{let{activeOrganization:t}=(0,i.YL)(),a=null==t?void 0:t.uuid,l=g();return(0,n.Qv)(t=>"/api/organizations/".concat(a,"/projects/").concat(e,"/syncs/").concat(t),"DELETE",(e,t)=>t?t.filter(t=>t.uuid!==e):t,{queryKey:[r.LV,{orgUuid:a,projectUuid:e}],enabled:!!t,onSuccess:()=>{l(e)}})},d=e=>{let{activeOrganization:t}=(0,i.YL)(),a=null==t?void 0:t.uuid,l=g();return(0,n.Qv)(()=>"/api/organizations/".concat(a,"/projects/").concat(e,"/syncs/delete_many"),"POST",(e,t)=>t?t.filter(t=>!e.sync_source_uuids.includes(t.uuid)):t,{queryKey:[r.LV,{orgUuid:a,projectUuid:e}],enabled:!!t,onSuccess:()=>{l(e)}})},f=function(e,t){let a=!(arguments.length>2)||void 0===arguments[2]||arguments[2],{activeOrganization:o}=(0,i.YL)(),u=null==o?void 0:o.uuid,c=(0,l.useQueryClient)(),d=!!(o&&e&&a),{data:f,isLoading:g}=(0,n.Sk)("/api/organizations/".concat(u,"/projects/").concat(e,"/syncs?calculate_size=").concat(null!=t&&t),{queryKey:[r.LV,{orgUuid:u,projectUuid:e,calculateSize:t}],enabled:d,refetchInterval:e=>{var t;return(null==(t=e.state.data)?void 0:t.some(s.z3))?5e3:3e5},structuralSharing:(t,a)=>{let n=void 0!==t&&t.some(s.z3),i=void 0!==a&&a.some(s.z3);return n&&!i&&c.invalidateQueries({queryKey:[r.qz,{orgUuid:u,projectUuid:e}]}),a}});return{data:f,isLoading:!!d&&g}},g=()=>{let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid,a=(0,l.useQueryClient)();return e=>{a.invalidateQueries({queryKey:[r.LV,{orgUuid:t,projectUuid:e}]}),a.invalidateQueries({queryKey:[r._G,{orgUuid:t,projectUuid:e}]}),a.invalidateQueries({queryKey:[r.qz,{orgUuid:t,projectUuid:e}]})}},p=e=>{let{data:t}=f(e);return!!(null==t?void 0:t.some(s.z3))}},64683:(e,t,a)=>{a.d(t,{Si:()=>P,i1:()=>D,vV:()=>z,fU:()=>k});var n=a(42977),i=a(54568),r=a(16253),l=a(53478),s=a(79194),o=a(77187),u=a(85644),c=a(47492),d=a(98518),f=a(77186),g=a(1761),p=a(69916),y=a(90510),m=a(12072),v=a(29585),h=a(46612),_=a(71473),b=a(27062),A=a(69055),w=a(16622),x=a(87606),L=a(7620),S=a(62971),C=a(46760),T=a(81133),E=a(17936);let M=[{matcher:e=>e.includes("password protected")||e.includes("document_password_protected"),createMessage:()=>(0,i.jsx)(S.A,{defaultMessage:"The document you uploaded is password protected. Please remove the password and try again.",id:"DHwwKwuaCR"})},{matcher:e=>e.includes("not supported"),extractor:e=>[...new Set(e.map(e=>(0,r.QC)(e.file.name)))],createMessage:e=>(0,i.jsx)(S.A,{defaultMessage:"Files of the following {count, plural, one {format is} other {formats are}} not supported: {formats}",id:"9JcWWPAZoB",values:{count:e.length,formats:(0,i.jsx)(T.dT,{type:"conjunction",value:e})}})},{matcher:e=>e.includes("exceeds maximum size")||e.includes("File too large"),extractor:e=>e.map(e=>({file_type:e.file.type,file_size:e.file.size})),createMessage:()=>{let e=Math.floor(l.gZ/1048576);return(0,i.jsx)(S.A,{defaultMessage:"You may not upload files larger than {sizeLimit}mb.",id:"nW3gZD88Va",values:{sizeLimit:e}})},trackAnalytics:(e,t)=>{e.track({event_key:"file_upload_too_large",large_files:t})}}];function j(){let e=(0,n._)(["\n  relative\n  grid\n  place-content-center\n  aspect-square\n  rounded-xl\n  cursor-pointer\n  transition\n  [fieldset:not(:disabled)_&]:hover:bg-bg-400\n  [fieldset:disabled_&]:opacity-50\n  [fieldset:disabled_&]:pointer-events-none\n  focus-within:ring\n  inline-flex\n  items-center\n  justify-center\n  relative\n  shrink-0\n  ring-offset-2\n  ring-offset-bg-300\n  ring-accent-main-100\n  focus-visible:outline-none\n  focus-visible:ring-1\n  disabled:pointer-events-none\n  disabled:opacity-50\n  disabled:shadow-none\n  disabled:drop-shadow-none\n  bg-[radial-gradient(ellipse,_var(--tw-gradient-stops))]\n  from-bg-500/10\n  from-50%\n  to-bg-500/30\n  border-0.5\n  border-border-400\n  font-medium\n  font-ui\n  text-text-100/90\n  transition-colors\n  active:bg-bg-500/50\n  hover:text-text-000\n  hover:bg-bg-500/60\n"]);return j=function(){return e},e}function P(e){let{syncSourceCount:t,files:a,setFiles:n,numExistingConversationFiles:s,attachments:c,setAttachments:d,numExistingConversationAttachments:f,detectSameAttachment:g,selectedModel:y,blobFileUploadsEnabled:v,conversationUuid:h,wiggleEnabled:_}=e,{addError:b}=(0,p.Y)(),x=(0,o.Z3)(null);return function(e){let{syncSourceCount:t,onUploadComplete:a,existingAttachments:n,existingFiles:s,numExistingConversationAttachments:o,numExistingConversationFiles:c,selectedModel:d,blobFileUploadsEnabled:f,conversationUuid:g,wiggleEnabled:p}=e,y=(0,C.A)(),{modelConfig:v}=(0,u.fC)(d),h=v.image_in,[_,b,x,T]=function(e){let{syncSourceCount:t,onUploadComplete:a,existingAttachments:n,existingFiles:r,numExistingConversationFiles:s,selectedModel:o,blobFileUploadsEnabled:c,conversationUuid:d,wiggleEnabled:f}=e,{modelConfig:g}=(0,u.fC)(o),p=g.image_in,y=D()&&g.pdf_in,{isUploading:m,setIsUploading:v,handleError:h,handleUpload:_}=z({imagesEnabled:p,blobFileUploadsEnabled:c,onUploadComplete:a,rasterizePdfUploadsEnabled:y,conversationUuid:d,wiggleEnabled:f}),b=(0,L.useCallback)(e=>{let{newUploads:a=[],numNewPotentialAttachments:o=0,showError:u=!0}=e;if(o+a.length+(n.length+r.length+t)>l.XA.maxTotalUploadsPerMessage)return u&&h((0,i.jsx)(S.A,{defaultMessage:"You can add at most {count, plural, one {# attachment} other {# attachments}} to a message. Please select fewer attachments.",id:"qxV00r12ob",values:{count:l.XA.maxTotalUploadsPerMessage}})),!1;let d=s||0,{messageFileCount:f}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=0,n=0,i=0;for(let r of e){let{willBecomeMessageFile:e,category:s}=function(e){var t;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=(null==(t=e.name.split(".").pop())?void 0:t.toLowerCase())||"";return l.h8.includes(n)?{category:"image",willBecomeMessageFile:!!a.imagesEnabled}:l.Ap.includes(n)?{category:"pdf",willBecomeMessageFile:!!a.rasterizePdfUploadsEnabled,requiresFeatureGate:"janus_claude-ai"}:l.PC.includes(n)?{category:"out-of-context",willBecomeMessageFile:!!a.blobFileUploadsEnabled,requiresFeatureGate:"ooc_attachments"}:l.BA.includes(n)?{category:"text",willBecomeMessageFile:!1}:l.pH.includes(n)?{category:"document",willBecomeMessageFile:!1}:{category:"unsupported",willBecomeMessageFile:!1}}(r,t);"unsupported"===s?i++:e?a++:n++}return{messageFileCount:a,messageAttachmentCount:n,unsupportedCount:i}}(a,{blobFileUploadsEnabled:c,imagesEnabled:p,rasterizePdfUploadsEnabled:y});if(d+f>l.XA.maxFilesPerConversation){var g;return u&&h((g=l.XA.maxFilesPerConversation,(0,i.jsx)(S.A,{defaultMessage:"You can add at most {count, plural, one {# file} other {# files}} to a chat. {suggestion}",id:"QyrCxYs5Jy",values:{count:g,suggestion:d<g?(0,i.jsx)(S.A,{defaultMessage:"Please select fewer files.",id:"a6KVizNPLe"}):(0,i.jsx)(S.A,{defaultMessage:"Please consider starting a new chat.",id:"oN0R8lZNm6"})}}))),!1}return!0},[n,r,t,h,c,s,p,y]);return[m,v,b,(0,L.useCallback)(async e=>{b({newUploads:e})&&await _(e)},[_,b])]}({syncSourceCount:t,onUploadComplete:a,existingFiles:s,existingAttachments:n,numExistingConversationFiles:c,numExistingConversationAttachments:o,selectedModel:d,blobFileUploadsEnabled:f,conversationUuid:g,wiggleEnabled:p}),E=function(e){let{handleUpload:t}=e,a=(0,L.useRef)({ready:0,total:0}),n=(0,L.useCallback)(()=>{a.current={ready:0,total:0}},[]),i=(0,L.useCallback)(e=>{a.current.ready+=1,a.current.total===a.current.ready&&t(e)},[t]),r=(0,L.useCallback)((e,t)=>{let n=e.length;for(let l=0;l<n;l++){let n=e[l];n.isFile?(a.current.total+=1,n.file(e=>{t.push(e),i(t)})):n.isDirectory&&n.createReader().readEntries(e=>{r(e,t)})}},[i]);return(0,L.useCallback)(e=>{var t;e.preventDefault(),n();let a=null==(t=e.dataTransfer)?void 0:t.items;if(!a)return;let i=[];for(let e=0;e<(null==a?void 0:a.length);e++){let t=a[e].webkitGetAsEntry();t&&i.push(t)}r(i,[])},[r,n])}({handleUpload:T}),M=(0,L.useCallback)(async e=>{await T(Array.from(e))},[T]),j=(0,L.useCallback)(async e=>{let t=e.target.files;t&&await T(Array.from(t)),e.target.value=""},[T]),P=Math.floor(l.XA.maxFileSize/1048576),k=h?(0,i.jsx)(S.A,{defaultMessage:"Upload docs or images to Claude\\n(Max {maxUploads}, {maxSize}mb each)",id:"TGYeob9u0b",values:{maxUploads:l.XA.maxTotalUploadsPerMessage,maxSize:P}}):(0,i.jsx)(S.A,{defaultMessage:"Add content ({maxUploads} max, {maxSize}mb each)\\nAccepts pdf, txt, csv, etc.",id:"rW/kw78ou7",values:{maxUploads:l.XA.maxTotalUploadsPerMessage,maxSize:P}}),F=(0,L.useCallback)(e=>{j(e)},[j]),G=(0,L.useMemo)(()=>({type:"file",accept:p?"":(0,r.cm)({imagesEnabled:h,outOfContextFilesEnabled:f}).join(","),onChange:F,multiple:!0,"aria-label":y.formatMessage({defaultMessage:"Upload files",id:"2jjdVzJX0c"})}),[h,f,p,F,y]);return[_,b,x,E,M,T,(0,i.jsx)(m.Tooltip,{className:"text-center",tooltipContent:k,children:(0,i.jsxs)(I,{children:[(0,i.jsx)("input",{"data-testid":"file-upload",className:"absolute inset-0 -z-10 overflow-hidden rounded-xl opacity-0",...G}),_?(0,i.jsx)(A.N,{className:"animate-spin",size:18}):(0,i.jsx)(w.x,{size:18,weight:"light"})]})},"upload-tooltip"),G]}({syncSourceCount:t,onUploadComplete:(0,L.useCallback)(async(e,t)=>{if(g&&e.find(e=>g(e.extracted_content)))return void b((0,i.jsx)(S.A,{defaultMessage:"The same attachment was already added earlier. Claude sees the full conversation when replying, so there’s no need to re-upload.",id:"Uo3qvhGn7z"}));d(t=>[...t,...e]),n(e=>[...e,...t]),await Promise.resolve()},[g,b,d,n]),existingAttachments:c,existingFiles:a,numExistingConversationAttachments:f,numExistingConversationFiles:s,selectedModel:null!=y?y:x,blobFileUploadsEnabled:v,conversationUuid:h,wiggleEnabled:_})}let k=()=>{let e=(0,f.mn)(),t=(0,x.useQueryClient)();return async(a,n,i)=>{let r=new FormData;r.append("file",a);let l=i?"/api/organizations/".concat(n,"/projects/").concat(i,"/upload"):"/api/".concat(n,"/upload"),s=await e(l,{method:"POST",body:r}),o=await s.json();if(s.ok)return i&&t.invalidateQueries({queryKey:[_.qz,{orgUuid:n,projectUuid:i}]}),o;throw(0,v.a5)(s.status,o,"File upload failed",s.headers)}},z=e=>{var t;let{imagesEnabled:a,blobFileUploadsEnabled:n,rasterizePdfUploadsEnabled:r,onUploadComplete:o,onError:u,projectUuid:f,conversationUuid:y,wiggleEnabled:m}=e,{activeOrganization:_}=(0,g.YL)(),b=null!=(t=null==_?void 0:_.uuid)?t:"",[A]=(0,c.d)(),w=y||A,[x,C]=(0,L.useState)(!1),{addError:T}=(0,p.Y)(),j=(()=>{let{addError:e}=(0,p.Y)();return(0,L.useCallback)((t,a)=>{if(t instanceof v.LG){if("rate_limit_error"===t.type)return void e((0,i.jsxs)("p",{children:[(0,i.jsx)(S.A,{defaultMessage:"You’ve reached your limit for {resourceType} uploads. Please try again later.",id:"M88GeEDB7r",values:{resourceType:a}}),(0,i.jsx)(E.W,{})]}),{error:t});if("document_password_protected"===t.errorCode)return void e((0,i.jsx)("p",{children:(0,i.jsx)(S.A,{defaultMessage:"The document you uploaded is password protected. Please remove the password and try again.",id:"DHwwKwuaCR"})}),{error:t})}if(t instanceof v.LG&&"Image is too large"===t.message)return void e((0,i.jsx)("p",{children:(0,i.jsx)(S.A,{defaultMessage:"Image is too large. <link>Learn more</link>",id:"SFbt+MAvby",values:{link:e=>(0,i.jsx)("a",{href:"https://support.anthropic.com/en/articles/9002500-what-kinds-of-images-can-i-upload-to-claude-ai",target:"_blank",rel:"noopener noreferrer",className:"underline hover:text-accent-main-100",children:e})}})}),{error:t});e((0,i.jsx)("p",{children:(0,i.jsx)(S.A,{defaultMessage:"Your {resourceType} upload failed. Please try again.",id:"ymWsV10Pz1",values:{resourceType:a}})}),{error:t})},[e])})(),P=(0,L.useCallback)(e=>{C(!1),T(e),u&&u()},[T,u,C]),k=(0,d.st)(),z=(0,L.useCallback)(async(e,t)=>{C(!0);try{if(!b)throw Error("Organization not loaded. Please try again.");let u=(0,s.e)(),c=(0,s.O)(e),d=function(e){let{orgUuid:t,projectUuid:a,conversationUuid:n,imagesEnabled:i,rasterizePdfUploadsEnabled:r,blobFileUploadsEnabled:s,wiggleEnabled:o}=e;return{orgUuid:t,projectUuid:a,conversationUuid:n,modelConfig:{image_in:i,pdf_in:r},featureGates:{janus_claude_ai:r,ooc_attachments:s,use_canvas_resize:!0,wiggleEnabled:o},limits:l.XA}}({orgUuid:b,projectUuid:f,conversationUuid:w,imagesEnabled:a,rasterizePdfUploadsEnabled:r,blobFileUploadsEnabled:n,wiggleEnabled:m}),g=await u.processFiles(c,d),{attachments:p,files:y,errors:v}=function(e){let t=[],a=[],n=[];for(let n of e.successful){let e=n.data;"attachment"===n.type?"extracted_content"in e&&t.push(e):"file_kind"in e&&a.push(e)}for(let t of e.failed)n.push({file:t.file,error:t.error});return{attachments:t,files:a,errors:n}}(g);if(function(e,t,a){if(0===e.length)return!1;for(let n of M){let i=e.filter(e=>n.matcher(e.error));if(i.length>0){let e=n.extractor?n.extractor(i):i;return n.trackAnalytics&&n.trackAnalytics(a,e),t(n.createMessage(e)),!0}}return e.forEach(e=>t(e.error)),!0}(v,P,k))return;let _=function(e,t,a){if(void 0===t||0===e.length)return e;let n=0,r=[];for(let l of e){if((n+=new Blob([l.extracted_content]).size/h.t2)>t)return a((0,i.jsx)(S.A,{defaultMessage:"Failed to upload file {filename}. Project knowledge exceeds maximum. Remove files to continue.",id:"MbvF6K3PJd",values:{filename:l.file_name}})),[];r.push(l)}return r}(p,t,P);if(0===_.length&&p.length>0)return;(_.length>0||y.length>0)&&await o(_,y)}catch(t){if(function(e,t){return e instanceof Error?(e.isRateLimit?t((0,i.jsx)(S.A,{defaultMessage:"Too many file upload attempts. Please wait and try again later.",id:"h/6cMHSn1V"})):413===e.statusCode||"file_too_large"===e.errorType?t((0,i.jsx)(S.A,{defaultMessage:"Uploaded file is too large. Try uploading a smaller part of the document, or copy/pasting an excerpt from the file.",id:"/mCoauj3Ws"})):"extraction_failed"===e.errorType?t((0,i.jsx)(S.A,{defaultMessage:"Text extraction failed for one of the uploaded files. Please try again.",id:"ngYPeW4aWf"})):t((0,i.jsx)(S.A,{defaultMessage:"One or more file uploads have failed. Please try again.",id:"FIwcYDeyIC"})),!0):(t((0,i.jsx)(S.A,{defaultMessage:"One or more file uploads have failed. Please try again.",id:"FIwcYDeyIC"})),!0)}(t,P))return;let e="file";t instanceof Error&&t.message.includes("image")&&(e="image"),j(t,e)}finally{C(!1)}},[n,o,a,w,P,j,b,k,r,f,m]);return{isUploading:x,setIsUploading:C,handleError:P,handleUpload:z}},I=y.J.label(j()),D=()=>{let{value:e}=(0,b.fS)("janus_claude-ai");return e}},77101:(e,t,a)=>{a.d(t,{I5:()=>r,sb:()=>i,v8:()=>n,xj:()=>l});var n=function(e){return e.GITHUB="github",e.GDRIVE="gdrive",e.OUTLINE="outlin",e.SALESFORCE="sfdc",e.GMAIL="gmail",e.GCAL="gcal",e.SLACK="slack",e.ASANA="asana",e.CANVAS="canvas",e.FIDDLEHEAD="fiddlehead",e.CUTTLEFISH="cuttlefish",e}({});let i={github:"GitHub",gdrive:"Google Drive",outlin:"Outline",sfdc:"Salesforce",gmail:"Gmail",gcal:"Google Calendar",slack:"Slack",asana:"Asana",canvas:"Canvas",fiddlehead:"Fiddlehead",cuttlefish:"Cuttlefish"};var r=function(e){return e.CREATED="created",e.PENDING="pending",e.FAILED="failed",e.UPDATING="updating",e.UPDATE_FAILED="update_failed",e.READY="ready",e.UNAUTHENTICATED="unauthenticated",e.ACCESS_DENIED="access_denied",e.DISABLED="disabled",e}({});let l=["access_denied","failed","unauthenticated","update_failed"]},85644:(e,t,a)=>{a.d(t,{A9:()=>d,Wq:()=>f,fC:()=>u});var n=a(77186),i=a(1761),r=a(71473),l=a(27062),s=a(85544);let o={image_in:!0,pdf_in:!1},u=e=>{let{activeOrganization:t}=(0,i.YL)(),a=null==t?void 0:t.uuid,{data:l,isLoading:s,isPlaceholderData:u}=(0,n.Sk)("/api/organizations/".concat(a,"/model_configs/").concat(e),{queryKey:[r.yV,a,e],enabled:!!a,staleTime:3e5,meta:{noToast:!0}});return{isLoading:s,modelConfig:!u&&l||o}},c=[],d=()=>{var e,t;let{value:a}=(0,l.fS)("backend_model_config"),{activeOrganization:n}=(0,i.YL)(),r=(0,l.T9)("claude_ai_models","models",c,s.KQ),o=a?null!=(t=null==n?void 0:n.claude_ai_bootstrap_models_config)?t:c:r;(null==n||null==(e=n.settings)?void 0:e.sampling_restriction)==="aws_marketplace"&&(o=o.filter(e=>e.model.toLowerCase().includes("sonnet")));let u=o.filter(e=>!e.inactive),d=u.filter(e=>!e.overflow),f=u.filter(e=>e.overflow);return{allModelOptions:o,activeModelOptions:u,mainModels:d,overflowModels:f}},f=()=>{let{allModelOptions:e}=d();return(t,a)=>{let n=e.find(e=>e.model===t);if(!n)return!1;let i=null==n?void 0:n.capabilities;return!i||!1!==i[a]}}},91768:(e,t,a)=>{a.d(t,{Dd:()=>S,FZ:()=>w,LN:()=>_,X0:()=>k,XE:()=>E,Ys:()=>M,dH:()=>x,eL:()=>C,fe:()=>z,ob:()=>P,ph:()=>A,tS:()=>h,xc:()=>b,z3:()=>L});var n=a(68096),i=a(77186),r=a(1761),l=a(69916),s=a(29585),o=a(71473),u=a(27062),c=a(77101),d=a(90119),f=a(21036),g=a(87606),p=a(62942),y=a(7620),m=a(46760),v=a(40459);let h=e=>e.type===c.v8.GITHUB?{sync_source_type:c.v8.GITHUB,sync_source_config:e.config}:e.type===c.v8.GDRIVE?{sync_source_type:c.v8.GDRIVE,sync_source_config:e.config}:null,_=()=>{let{activeOrganization:e}=(0,r.YL)(),t=null==e?void 0:e.uuid;return(0,i.Sk)("/api/organizations/".concat(t,"/sync/settings"),{queryKey:[o._V,{orgUUID:t}],enabled:!!e})},b=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:t}=(0,r.YL)(),a=null==t?void 0:t.uuid,n=(0,g.useQueryClient)();return(0,i.Qv)("/api/organizations/".concat(a,"/sync/settings"),"PUT",(e,t)=>{let{type:a,enabled:n}=e;t||(t=[]);let i=t.map(e=>e.type===a?{...e,enabled:n}:e);return i.some(e=>e.type===a)?i:[...t,{type:a,enabled:n}]},{queryKey:[o._V,{orgUUID:a}],enabled:!!t,onSuccess:async function(){for(var t,i=arguments.length,r=Array(i),l=0;l<i;l++)r[l]=arguments[l];await n.invalidateQueries({queryKey:[o._V,{orgUUID:a}]}),await (null==(t=e.onSuccess)?void 0:t.call(e,...r))},meta:{errorMessage:"There was an error changing your settings. Please try again."},...e})},A=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:t}=(0,r.YL)(),a=null==t?void 0:t.uuid,n=(0,g.useQueryClient)(),{value:l}=(0,u.fS)("kingfisher_enabled"),{value:s}=(0,u.fS)("apps_use_bananagrams"),c=(0,f.useLayer)("trials_freemium").get("free_integrations",!1);return(0,i.Qv)("/api/organizations/".concat(a,"/sync/settings/config"),"POST",(e,t)=>{let{type:a,config:n}=e;return t||(t=[]),t.map(e=>e.type===a?{...e,config:{...e.config,...n}}:e)},{queryKey:[o._V,{orgUUID:a}],enabled:!!(t&&(l||c)&&s),onSuccess:async function(){for(var t,i=arguments.length,r=Array(i),l=0;l<i;l++)r[l]=arguments[l];await n.invalidateQueries({queryKey:[o._V,{orgUUID:a}]}),await (null==(t=e.onSuccess)?void 0:t.call(e,...r))},meta:{errorMessage:"There was an error changing your settings. Please try again."},...e})},w=e=>{let{callerIdentifier:t,successParam:a,handleOpen:n}=e,i=(0,p.useSearchParams)(),r=(0,y.useRef)(!1);(0,y.useEffect)(()=>{!i.has(a)||r.current||t&&t!==i.get(a)||(r.current=!0,((e,t)=>{let a=new URLSearchParams(Array.from(t.entries()));a.delete(e);let n=a.toString()?"?".concat(a.toString()):"",i=window.location.pathname+n;window.history.replaceState({...window.history.state,as:i,url:i},"",i)})(a,i),n())},[i,t,n,a])},x=e=>{let{pathname:t,searchParams:a,queryString:n,isClaudeApp:i}=e,r="".concat(t,"?").concat(n),l=a.get("origin");if(l)r=l;else if(i){let e=/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/i,a=t.startsWith("/project/")&&e.test(t.slice(9)),i=t.startsWith("/chat/")&&e.test(t.slice(6)),l=a||i||"/new"===t?t:"/new";r="claude://claude.ai".concat(l,"?").concat(n)}return r},L=e=>{let t;return t=e.status.state,[c.I5.CREATED,c.I5.PENDING,c.I5.UPDATING].includes(t)},S=e=>[c.I5.FAILED,c.I5.UPDATE_FAILED].includes(e.status.state),C=()=>{let{addError:e}=(0,l.Y)(),t=(0,g.useQueryClient)();return(a,n)=>{(e=>{if(e instanceof s.LG)return e instanceof s.LG&&"access_denied"===e.errorCode})(a)&&(e("Please try again. You may need to reconnect with your ".concat(c.sb[n.sync_source_type]," account."),{error:a}),o.ku.forEach(e=>{t.invalidateQueries({queryKey:[e]})}),t.invalidateQueries({queryKey:[o.GC]}))}},T={[c.v8.GCAL]:"enabled_foccacia",[c.v8.GMAIL]:"enabled_sourdough"},E=e=>{let t=e===c.v8.GCAL||e===c.v8.GMAIL?"pumpernickel_enabled":"cinnabon_enabled",{value:a}=(0,u.fS)(t),n=(0,f.useLayer)("trials_freemium").get("free_integrations",!1),i=a||(e===c.v8.GCAL||e===c.v8.GMAIL)&&n;return!v.env.NEXT_PUBLIC_DISABLE_INTEGRATIONS&&i},M=e=>{let t=(e=>{let t=(0,r.mV)(),{data:a}=_(),n=!!(Array.isArray(a)&&a.find(t=>t.type===e&&t.enabled));return!t||n})(e);return!!(E(e)&&t)},j=e=>"sfdc"===e?"salesforce":e,P=function(e){let{callerIdentifier:t,handleAuthSuccess:a,pathname:n,queryString:s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{activeOrganization:o}=(0,r.YL)(),u=null==o?void 0:o.uuid,f=(0,p.usePathname)(),v=(0,p.useSearchParams)(),{addSuccess:h}=(0,l.Y)(),_=(0,m.A)(),b=M(e),A=(0,g.useQueryClient)(),L=(0,d.V)(),{data:S,isFetched:C}=(0,i.Sk)("/api/organizations/".concat(u,"/sync/").concat(j(e),"/auth"),{queryKey:["sync_".concat(e,"_auth_status"),{orgUUID:u}],enabled:!!(o&&b)}),T=(0,y.useRef)(!1),{mutate:E}=(0,i.L2)("/api/organizations/".concat(u,"/sync/").concat(j(e),"/auth/start"),"POST",{enabled:!!(o&&b),onSuccess:e=>{window.location.href=e.redirect_url}});w({callerIdentifier:t,successParam:"".concat(e,"_success"),handleOpen:()=>{h(_.formatMessage({defaultMessage:"Successfully connected to {integrationName}",id:"T7cL93l/KQ"},{integrationName:c.sb[e]})),null==a||a(!0)}});let{mutate:P}=(0,i.L2)("/api/organizations/".concat(u,"/sync/").concat(j(e),"/auth"),"DELETE",{enabled:!!(o&&b),onSuccess:()=>{A.invalidateQueries({queryKey:["sync_".concat(e,"_auth_status"),{orgUUID:u}]})}});return{isAuthenticated:b&&!!(null==S?void 0:S.is_authenticated),startAuth:()=>{if(!T.current&&b){let a=x({pathname:n||f,searchParams:v,queryString:"".concat(e,"_success=").concat(t).concat(s?"&".concat(s):""),isClaudeApp:L});if(L){window.location.href="/settings/connectors?open_in_browser=1&auth_start=".concat(e,"&origin=").concat(a);return}T.current=!0,E({pre_auth_state:{origin:a},redirect_uri:new URL("/connect/".concat(j(e),"/callback"),window.location.origin).toString()})}},disconnect:P,isFetched:C}},k=(e,t)=>{var a,n;let i=M(e),{account:l}=(0,r.YL)(),s=T[e];return s?i&&(t?!!(null==t||null==(a=t.conversationSettings)?void 0:a[s]):!!(null==l||null==(n=l.settings)?void 0:n[s])):i},z=()=>{let{account:e}=(0,r.YL)(),{mutate:t}=(0,n.Jy)();return{toggleIntegrationEnabled:(a,n)=>{if(!e)return;let i=T[a];i&&t({...e.settings,[i]:n})}}}},98251:(e,t,a)=>{a.d(t,{Bg:()=>u,fR:()=>f,iV:()=>d,ih:()=>c,nI:()=>g});var n=a(77186),i=a(1761),r=a(69916),l=a(71473),s=a(77101),o=a(87606);let u=()=>{let{account:e,activeOrganization:t}=(0,i.YL)(),a=null==e?void 0:e.uuid,r=null==t?void 0:t.uuid,u=(0,o.useQueryClient)();return(0,n.L2)("/api/organizations/".concat(r,"/sync/mcp/drive/ingest"),"POST",{onSuccess:()=>{setTimeout(()=>{u.invalidateQueries({queryKey:[l.hx,{orgUuid:r,accountUuid:a,syncSourceType:s.v8.GDRIVE}]})},300)}})},c=()=>{let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid,{addError:a}=(0,r.Y)(),u=(0,o.useQueryClient)();return(0,n.L2)("/api/organizations/".concat(t,"/sync/ingestion/gdrive/clean_up"),"POST",{onSuccess:()=>{u.invalidateQueries({queryKey:[l.hx,{orgUuid:t,syncSourceType:s.v8.GDRIVE}]})},onError:e=>{a(e.message,{error:e})}})},d=e=>{let{activeOrganization:t}=(0,i.YL)(),a=null==t?void 0:t.uuid,r=(0,o.useQueryClient)();return(0,n.L2)("/api/organizations/".concat(a,"/projects/").concat(e,"/kb/resync"),"POST",{enabled:!!e,meta:{noToast:!0},onSuccess:t=>{"done"===t.status&&r.invalidateQueries({queryKey:[l.qz,{orgUuid:a,projectUuid:e}]})}})},f=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],{activeOrganization:a}=(0,i.YL)(),r=null==a?void 0:a.uuid;return(0,n.Sk)("/api/organizations/".concat(r,"/projects/").concat(e,"/kb/stats"),{queryKey:[l.qz,{orgUuid:r,projectUuid:e}],enabled:!!e&&t})},g=()=>{let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid;return(0,n.L2)("/api/organizations/".concat(t,"/conversation/backfill"),"POST",{})}}}]);