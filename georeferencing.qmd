# Georeferencing

## What is Georeferencing?

+ __Georeferencing__ is the process by which real-world locations ascribed to data. 
+ __Ground Control Points__ or GCPs are how we tell the computer which points on the non-georeferenced image correspond to real-world coordinates.
+ A __Tranform__ then applies translation , rotation, etc... to warp the image to fit.


## Example: Swanton Ranch Treasure Map {style="font-size:0.7em"}

[Download the Swanton Ranch [treasure_map.tif](https://cpslo-my.sharepoint.com/:i:/g/personal/mthuggin_calpoly_edu/IQAFCm6au_XOS6iSzhaagpzRAZj2F4_xdMvI9amljbzp3Ww?e=4IIlp9). Put it someplace sensible.]{style="font-size:0.6em"}

![](img/treasure_map.png)


## What Is A TIF

::: {.incremental}
- A `tif` is a container format
- It stores image pixels plus tags (metadata)
- Compression of the image inside the container can be: none, lossless (LZW, Deflate, etc...), or JPEG
- __A GeoTIFF is a TIFF with georeferencing tags__
- A regular TIFF lacks georeferencing tags 
:::


## Normal TIFs, No Georeferencing

This is just a regular tif, but we want to use it in a GIS program

![](img/treasure_map.png)

## Georeferencing In A TIF {style="font-size:0.7em"}

::: {.r-stack}
::: {.fragment .absolute .fade-out data-fragment-index="1"}

- Pixel grid: rows/columns only (`x`,`y`)
- No real-world location yet

:::
::: {.fragment .absolute .fade-in-then-out data-fragment-index="1"}

- GeoTIFF adds tags that map pixel space to map space
- Key tags: CRS + affine transform

:::
::: {.fragment .absolute .fade-in data-fragment-index="2"}

`(col,row)` + GeoTIFF tags -> `(lon,lat)` or `(easting,northing)`

So georeferencing is stored in metadata, not drawn into pixels.

:::
:::


## Tutorial: Geoferencing the Treasure Map {style="font-size:0.7em"}

::: {.r-stack}
::: {.fragment .absolute .fade-out data-fragment-index="1"}

1. Open QGIS
2. Open Georeferncer (`Layer` > `Georeferencer`)
3. Open the raster (this button ![](img/raster_icon.png){style="height:1.2em; vertical-align:middle;"})
4. Select `treasure_map.tif` ![](img/treasure_map.png){style="height:5em; vertical-align:middle;"}
:::
::: {.fragment .absolute .fade-in-then-out data-fragment-index="1"}

![](img/treasure_map_processing.png){style="height: 500px;"}

:::
::: {.fragment .absolute .fade-in-then-out data-fragment-index="2"}
:::: {.columns}

::: {.column width="60%"}
+ Open Transformation Settings 
+ Select `Polynomial 1` for `Transformation Type`
+ Set output file 
+ Click ok
:::

::: {.column width="40%"}
![](img/settings_icon.png)
![](img/transformation_settings.png)
:::

::::

:::
::: {.fragment .absolute .fade-in-then-out data-fragment-index="3"}

Can anyone find where (in Swanton) our treasure map might correspond to?

What geographic features are helpful for identifying?

:::
::: {.fragment .absolute .fade-in-then-out data-fragment-index="4"}
:::: {.columns}

::: {.column width="60%"}

::: {style="font-size:0.7em"}
+ Once you find the place:
    + Add GCPs
    + Click a point on the image
    + The `Enter Map Coordinates` box should pop up
    + Select the `From Map Canvas` button
    + Click point
    + Click ok 
    + Repeat 4x
:::

:::
::: {.column width="40%"}

![](img/add_point_icon.png)
![](img/map_coordinates.png)

:::
::::
:::
::: {.fragment .absolute .fade-in-then-out data-fragment-index="5"}
:::: {.columns}

::: {.column width="70%"}

::: {style="font-size:0.8em"}
Georeferencer dialogue should look like this:
:::

![](img/georeferencer_dialogue.png)

:::
::: {.column width="30%"}

::: {style="font-size:0.8em"}
Click `Run`
:::

![](img/run_icon.png)

:::
::::
:::

::: {.fragment .absolute .fade-in-then-out data-fragment-index="6"}

Inspect the result - turn on transparency

:::

::: {.fragment .absolute .fade-in-then-out data-fragment-index="7"}
:::
:::

## Lab 15 {style="font-size:0.7em"}
__Georeferencing Assignment__  

+ Try again
+ Experiment with different transformations / resampling techniques
+ Add more GCPs

__Answer the following questions:__

1. As you add more GCPs initially the accuracy increases rapidly, at some point, adding new points starts to make less of a difference.
Based on this how many GCPs do you think is enough.
2. Were you able to notice any difference using different transformations and resampling techniques?  Which do you think worked best?
3. Include an image of the georeferenced map overlaying the basemap, (with enough transparency to see the alignment, also include your GCPs) 

